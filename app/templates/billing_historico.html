{% extends "base.html" %}
{% block title %}Histórico de Notas{% endblock %}
{% block content %}
<div class="container">
  <h2 class="text-center my-4">Histórico de Notas de Honorários</h2>

  <!-- Formulário de Filtros -->
  <form method="GET" action="{{ url_for('main.billing_historico') }}" class="mb-4">
    <div class="row g-3">
      <div class="col-md-3">
        <label for="cliente" class="form-label">Cliente</label>
        <input type="text" class="form-control" id="cliente" name="cliente" value="{{ request.args.get('cliente', '') }}">
      </div>
      <div class="col-md-3">
        <label for="data_emissao" class="form-label">Data de Emissão</label>
        <input type="date" class="form-control" id="data_emissao" name="data_emissao" value="{{ request.args.get('data_emissao', '') }}">
      </div>
      <div class="col-md-3">
        <label for="min_horas" class="form-label">Horas Mínimas</label>
        <input type="number" step="0.1" class="form-control" id="min_horas" name="min_horas" value="{{ request.args.get('min_horas', '') }}">
      </div>
      <div class="col-md-3">
        <label for="processo" class="form-label">Número do Processo</label>
        <input type="text" class="form-control" id="processo" name="processo" value="{{ request.args.get('processo', '') }}">
      </div>
    </div>
    <div class="row mt-3">
      <div class="col">
        <button type="submit" class="btn btn-primary">Filtrar</button>
        <a href="{{ url_for('main.billing_historico') }}" class="btn btn-secondary">Limpar Filtros</a>
      </div>
    </div>
  </form>

  <!-- Exibição das Notas -->
  {% if nota_honorarios %}
    <div class="list-group">
      {% for nota in nota_honorarios %}
        <div class="list-group-item">
          <h5>Nota #{{ loop.index }} – Cliente: {{ nota.client.name }}</h5>
          <p><strong>Data:</strong> {{ nota.created_at.strftime('%d/%m/%Y %H:%M') }}</p>
          <p><strong>Total de Horas:</strong> {{ nota.total_hours }}h</p>
          <pre>{{ nota.details }}</pre>
        </div>
      {% endfor %}
    </div>
    {% set args = request.args.to_dict() %}
    {% set _ = args.pop('page', None) %}
    <nav aria-label="Page navigation" class="mt-4">
      <ul class="pagination justify-content-center">
        {% if pagination.has_prev %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('main.billing_historico', page=pagination.prev_num, **args) }}">Anterior</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Anterior</span></li>
        {% endif %}
        {% for page in pagination.iter_pages(left_edge=2, right_edge=2, left_current=2, right_current=2) %}
          {% if page %}
            {% if page == pagination.page %}
              <li class="page-item active"><span class="page-link">{{ page }}</span></li>
            {% else %}
              <li class="page-item"><a class="page-link" href="{{ url_for('main.billing_historico', page=page, **args) }}">{{ page }}</a></li>
            {% endif %}
          {% else %}
            <li class="page-item disabled"><span class="page-link">...</span></li>
          {% endif %}
        {% endfor %}
        {% if pagination.has_next %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('main.billing_historico', page=pagination.next_num, **args) }}">Próximo</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Próximo</span></li>
        {% endif %}
      </ul>
    </nav>
  {% else %}
    <p>Nenhuma nota emitida.</p>
  {% endif %}
  <div class="mt-3">
    <a href="{{ url_for('main.billing') }}" class="btn btn-secondary">Voltar ao Billing</a>
  </div>
</div>
{% endblock %}
